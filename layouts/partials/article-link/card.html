{{/*
Standard Card Partial (Reverted to Homepage-Safe Version)
Supports:
- Jazz Mode: Research themes (Custom design)
- Default Mode: Blowfish theme default augmented for pal-ku params
*/}}

{{/* Extract Context and Params */}}
{{ $page := . }}
{{ $jazz := false }}
{{ $disableLink := false }}
{{ $hideMetadata := false }}
{{ $imageClass := "thumbnail_card" }}

{{ if reflect.IsMap . }}
{{ $page = .Page | default . }} {{/* Fixed context fallback */}}
{{ $jazz = .jazz | default false }}
{{ $disableLink = .disableLink | default false }}
{{ $hideMetadata = .hideMetadata | default false }}
{{ $imageClass = .imageClass | default "thumbnail_card" }}
{{ end }}

{{ if $jazz }}
{{/* JAZZ MODE (Research Themes) */}}
<div class="relative h-full group isolate">
    <div
        class="absolute inset-0 rounded-2xl bg-gradient-to-br from-red-500 via-purple-600 to-blue-600 opacity-80 group-hover:opacity-100 transition-opacity duration-300">
    </div>
    <div class="absolute inset-[1.5px] rounded-[15px] bg-white dark:bg-neutral-950"></div>
    <article class="relative h-full p-6 flex flex-col z-10">
        <header class="flex items-center gap-4 mb-6">
            {{ if $page.Params.icon }}
            <div
                class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-lg bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 text-2xl text-transparent bg-clip-text bg-gradient-to-br from-red-500 to-blue-600">
                {{ partial "icon.html" $page.Params.icon }}
            </div>
            {{ end }}
            <h2 class="text-lg font-bold text-neutral-900 dark:text-white leading-tight">
                {{ $page.Title }}
            </h2>
        </header>
        <div
            class="w-full h-px bg-gradient-to-r from-neutral-200 via-neutral-100 to-transparent dark:from-neutral-800 dark:via-neutral-900 mb-6">
        </div>
        {{ if $page.Params.showSummary | default (site.Params.list.showSummary | default false) }}
        <div class="text-sm text-neutral-600 dark:text-neutral-400 leading-relaxed mb-6">
            {{ $page.Summary | plainify }}
        </div>
        {{ end }}
        {{ if $page.Params.details }}
        <ul class="space-y-3 mt-auto">
            {{ range $page.Params.details }}
            <li class="flex items-start text-xs font-medium text-neutral-500 dark:text-neutral-400">
                <span class="mr-2 text-blue-500 flex-shrink-0">âœ“</span>
                <span>{{ . }}</span>
            </li>
            {{ end }}
        </ul>
        {{ end }}
    </article>
</div>
{{ else }}
{{/* STANDARD MODE (Safe for FAQ/Methodology) */}}
{{ $disableImageOptimization := site.Store.Get "disableImageOptimization" }}
{{ $featured := "" }}
{{ $featuredURL := "" }}
{{ if not $page.Params.hideFeatureImage }}
{{ with $page.Params.featureimage }}
{{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
{{ if site.Params.hotlinkFeatureImage }}{{ $featuredURL = . }}{{ else }}{{ $featured = resources.GetRemote . }}{{ end }}
{{ else }}{{ $featured = resources.Get . }}{{ end }}
{{ end }}
{{ if not (or $featured $featuredURL) }}
{{ $images := $page.Resources.ByType "image" }}
{{ range slice "*feature*" "*cover*" "*thumbnail*" }}{{ if not $featured }}{{ $featured = $images.GetMatch . }}{{ end
}}{{ end }}
{{ end }}
{{ if not (or $featured $featuredURL) }}
{{ $default := site.Store.Get "defaultFeaturedImage" }}
{{ if $default.url }}{{ $featuredURL = $default.url }}{{ else if $default.obj }}{{ $featured = $default.obj }}{{ end }}
{{ end }}
{{ if not $featuredURL }}{{ with $featured }}{{ $featuredURL = .RelPermalink }}{{ if not (or $disableImageOptimization
(eq .MediaType.SubType "svg")) }}{{ $featuredURL = (.Resize "600x").RelPermalink }}{{ end }}{{ end }}{{ end }}
{{ end }}
<article
    class="article-link--card relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600 flex flex-col items-start text-left">
    {{ with $featuredURL }}
    {{ if $disableLink }}
    <div class="w-full aspect-video relative overflow-hidden bg-neutral-200 dark:bg-neutral-800 {{ $imageClass }}">
        <img src="{{ . }}" role="presentation" loading="lazy" decoding="async"
            class="not-prose absolute inset-0 w-full h-full object-cover nozoom">
    </div>
    {{ else }}
    <a href="{{ $page.RelPermalink }}"
        class="block w-full aspect-video relative overflow-hidden bg-neutral-200 dark:bg-neutral-800 {{ $imageClass }}">
        <img src="{{ . }}" role="presentation" loading="lazy" decoding="async"
            class="not-prose absolute inset-0 w-full h-full object-cover nozoom">
    </a>
    {{ end }}
    {{ end }}
    <div class="p-4 flex flex-col items-start text-left w-full">
        <header>
            {{- if $disableLink -}}
            <h2 class="text-xl font-bold text-neutral-800 dark:text-neutral">{{ $page.Title | emojify }}</h2>
            {{- else -}}
            <a {{ with $page.Params.externalUrl }}href="{{ . }}" target="_blank" rel="external" {{ else
                }}href="{{ $page.RelPermalink }}" {{ end }}
                class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2">
                <h2>{{ $page.Title | emojify }}{{ if $page.Params.externalUrl }}<span
                        class="cursor-default align-top text-xs text-neutral-400 dark:text-neutral-500"><span
                            class="rtl:hidden">&#8599;</span><span class="ltr:hidden">&#8598;</span></span>{{ end }}
                </h2>
            </a>
            {{- end -}}
        </header>
        {{ if not $hideMetadata }}
        <div class="text-sm text-neutral-500 dark:text-neutral-400">{{ partial "article-meta/basic.html" $page }}</div>
        {{ end }}
        {{ if $page.Params.showSummary | default (site.Params.list.showSummary | default false) }}
        <div class="article-link__summary prose dark:prose-invert mt-1">
            {{ if $disableLink }}
            {{ $page.Content }}
            {{ else }}
            {{ $page.Summary | plainify }}
            {{ end }}
        </div>
        {{ end }}
    </div>
</article>
{{ end }}